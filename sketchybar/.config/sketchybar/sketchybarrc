#!/usr/bin/env bash

# Set defaults to reduce repetition (fonts and sizing only, colors set by theme.sh)
sketchybar --default \
    icon.font="JetBrainsMono Nerd Font:Regular:16.0" \
    label.font="JetBrainsMono Nerd Font:Regular:16.0"

sketchybar --bar height=38 \
                 blur_radius=40 \
                 padding_left=38 \
                 padding_right=38 \
                 border_width=1 \
                 margin=-2 \
                 y_offset=-2

sketchybar --add event aerospace_workspace_change
sketchybar --add event window_focus

# Theme monitor - responds to system appearance changes
sketchybar --add item theme_monitor center \
    --subscribe theme_monitor system_woke \
    --set theme_monitor \
    update_freq=3 \
    script="$CONFIG_DIR/plugins/theme.sh" \
    drawing=off

# Left side items
for sid in $(aerospace list-workspaces --all); do
    sketchybar --add item space.$sid left \
        --subscribe space.$sid aerospace_workspace_change \
        --set space.$sid \
        icon="â—‹" \
        icon.padding_right=12 \
        icon.font="JetBrainsMono Nerd Font:Regular:18.0" \
        click_script="aerospace workspace $sid" \
        script="$CONFIG_DIR/plugins/aerospace.sh $sid"
done

sketchybar --add item window_title left \
    --subscribe window_title window_focus aerospace_workspace_change \
    --set window_title \
    label.font="JetBrainsMono Nerd Font:Bold:16.0" \
    script="$CONFIG_DIR/plugins/window_title.sh"

# Right side items
sketchybar --add item battery right \
    --set battery \
    update_freq=30 \
    icon.padding_left=16 \
    label.padding_left=8 \
    drawing=off \
    script="$CONFIG_DIR/plugins/battery.sh"

sketchybar --add item wifi right \
    --set wifi \
    update_freq=10 \
    icon.padding_left=20 \
    label.padding_left=4 \
    label.padding_right=8 \
    script="$CONFIG_DIR/plugins/wifi.sh"

# Apply theme and trigger initial updates
# Note: theme.sh will trigger workspace_change event. Force flag ensures colors are set on reload.
"$CONFIG_DIR/plugins/theme.sh" --force
